{{ if eq .chezmoi.os "darwin" -}}
#!/bin/bash

# Count packages to install
BREW_COUNT={{ len .brews }}
CASK_COUNT={{ len .casks }}
TOTAL_COUNT=$((BREW_COUNT + CASK_COUNT))

echo "ðŸ“¦ Found $TOTAL_COUNT packages to install ($BREW_COUNT CLI tools, $CASK_COUNT applications)"

# Check if we're in an interactive terminal
if [ -t 0 ]; then
    echo ""
    read -p "Install all packages? [y/N] " -n 1 -r
    echo ""
    
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo "Skipping package installation"
        exit 0
    fi
else
    echo "ðŸ“¦ Running in non-interactive mode, installing packages..."
fi

echo "ðŸ“¦ Installing packages..."

brew bundle --file=/dev/stdin <<EOF
{{ range .taps -}}
tap {{ . | quote }}
{{ end -}}
{{ range .brews -}}
brew {{ . | quote }}
{{ end -}}
{{ range .casks -}}
cask {{ . | quote }}
{{ end -}}
EOF

echo "âœ… Package installation complete!"
{{ end -}}